-- Find unused indexes
SELECT *
FROM sys.dm_db_index_usage_stats
WHERE database_id = DB_ID()
AND user_seeks = 0
AND user_scans = 0
AND user_lookups = 0;



---------------------------

-- Find missing indexes
SELECT 
    migs.avg_user_impact,
    mid.statement AS table_name,
    mid.equality_columns,
    mid.inequality_columns,
    mid.included_columns
FROM sys.dm_db_missing_index_group_stats migs
JOIN sys.dm_db_missing_index_groups mig
    ON migs.group_handle = mig.index_group_handle
JOIN sys.dm_db_missing_index_details mid
    ON mig.index_handle = mid.index_handle
ORDER BY migs.avg_user_impact DESC;

-- Check index usage
SELECT 
    OBJECT_NAME(i.object_id) AS table_name,
    i.name AS index_name,
    us.user_seeks,
    us.user_scans,
    us.user_lookups,
    us.user_updates
FROM sys.indexes i
LEFT JOIN sys.dm_db_index_usage_statsZ us
    ON i.object_id = us.object_id
    AND i.index_id = us.index_id
WHERE OBJECTPROPERTY(i.object_id,'IsUserTable') = 1;
